---
title: 表达式求值
date: 2022-10-30 13:01:28
categories: [算法竞赛]
tags: [模拟表达式求值]
excerpt: 之前网络赛要写个表达式求值的算法, 写寄了, 以此铭记。
sticky: 0
mathjax: true
---

### 表达式求值

```cpp
namespace CAL {
    int expression(char*&s);  // 计算一个不带括号的表达式值
    int token(char*&s) {      // 取出一个值加入到栈中
        if(*s == '(') {
            s ++;
            int ret = expression(s);
            s ++;
            return ret;
        }
        int ret = 0;
        while('0' <= *s && *s <= '9'){
            ret = ret * 10 + *s++ - '0';
        }
        return ret % mod;
    }
    int rank(char op) {
        switch(op) {
            case '-': return 1;
            case '+': return 1;
            case '*': return 0;
        }
        return 2;
    }
    int expression(char*&s){
        stack<int> svar;
        stack<char> sop;
        svar.push(token(s));
        while(true){
            char op = *s;
            if(!op || op == ')') op = '$';
            else s++;
            while(!sop.empty() && rank(sop.top()) <= rank(op)){
                int b = svar.top();
                svar.pop();
                int a = svar.top();
                svar.pop();
                switch(sop.top()){
                    case '+':{
                        svar.push(a + b);
                        break;
                    }
                    case '-':{
                        svar.push(a - b);
                        break;
                    }
                    case '*': {
                        svar.push(a * b);
                        break;
                    }
                }
                sop.pop();
            }
            if(op == '$') break;
            svar.push(token(s));
            sop.push(op);
        }
        return svar.top();
    }
}
char s[MAXN];
int main() {
	ios::sync_with_stdio(false);
	cin.tie(0);
	cin >> s;
	char *test = s;
	cout << CAL::expression(test);
}
```
